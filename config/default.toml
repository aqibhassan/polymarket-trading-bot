[strategy.false_sentiment]
entry_threshold_base = 0.59
threshold_time_scaling = 0.15
lookback_candles = 5
min_confidence = 0.6
max_hold_minutes = 7
force_exit_minute = 11
no_entry_after_minute = 8

[strategy.momentum_confirmation]
# Optimal tiered entry from 132K candle backtest (3 months real BTC data)
# Validated on 2,471 real Polymarket trades: 89.4% accuracy, $20.49 net EV/trade
# Break-even accuracy: 74.3% (15pp safety margin)
entry_minute_start = 8
entry_minute_end = 10
hold_to_settlement = true
profit_target_pct = 0.40
stop_loss_pct = 1.00
max_hold_minutes = 10
resolution_guard_minute = 15
min_confidence = 0.55
# From real Polymarket validation (2,471 trades, Jan-Feb 2026)
estimated_win_prob = 0.884

[[strategy.momentum_confirmation.entry_tiers]]
minute = 8
threshold_pct = 0.10

[[strategy.momentum_confirmation.entry_tiers]]
minute = 9
threshold_pct = 0.08

[[strategy.momentum_confirmation.entry_tiers]]
minute = 10
threshold_pct = 0.05

[strategy.singularity]
# Re-optimized config (Feb 2026): 83.83% WR, 64K trades, Sharpe 2.42
# Neutral time-of-day, effective_min floor of 2, cum_return==0 guard
# Tuned Feb 10: lowered momentum thresholds + contrarian filter to reduce
# insufficient_agreement skips (28/54 windows skipped, 85% from this reason).
# Live data showed only OFI + time_of_day voting; momentum needs lower thresholds.
entry_minute_start = 2
entry_minute_end = 12
min_confidence = 0.45
min_signals_agree = 2
hold_to_settlement = true
stop_loss_pct = 1.00
profit_target_pct = 0.40
resolution_guard_minute = 15
estimated_win_prob = 0.838
weight_momentum = 0.30
weight_ofi = 0.25
weight_futures = 0.15
weight_vol = 0.10
weight_time = 0.10
# Contrarian filter: allow entries when BTC has moved up to 0.10% against
# signal direction. Default 0.0% was blocking legitimate ensemble signals.
skip_contrarian = true
contrarian_threshold_pct = 0.10
# Momentum veto: block entry when momentum actively disagrees with majority
momentum_veto_enabled = true
momentum_veto_min_strength = 0.15

[[strategy.singularity.entry_tiers]]
minute = 2
threshold_pct = 0.30

[[strategy.singularity.entry_tiers]]
minute = 3
threshold_pct = 0.25

[[strategy.singularity.entry_tiers]]
minute = 8
threshold_pct = 0.10

[[strategy.singularity.entry_tiers]]
minute = 9
threshold_pct = 0.08

[[strategy.singularity.entry_tiers]]
minute = 10
threshold_pct = 0.06

[[strategy.singularity.entry_tiers]]
minute = 11
threshold_pct = 0.04

[[strategy.singularity.entry_tiers]]
minute = 12
threshold_pct = 0.02

[exit]
profit_target_pct = 0.05
trailing_stop_pct = 0.03
hard_stop_loss_pct = 0.04
max_hold_seconds = 420

[risk]
max_position_pct = 0.02
min_position_pct = 0.01
max_daily_drawdown_pct = 0.05
max_order_book_pct = 0.10
min_spread_threshold = 0.02
min_profitable_move = 0.03

# Kelly position sizing for binary prediction markets
# f* = (p - P) / (P * (1 - P)), then multiply by kelly_multiplier
# Floor at min_position_pct (1%), cap at max_position_pct (5%)
# Quarter-Kelly recommended: balances growth vs drawdown risk
# Validated: 0% ruin probability, <10% max drawdown at 99th percentile
kelly_multiplier = 0.25
min_starting_balance = 10000

[risk.fees]
# Polymarket 15-min crypto dynamic taker fee curve
# fee = position_size * 0.25 * price^2 * (1 - price)^2
# Peaks at 1.56% at 50/50 odds, drops to ~0.2% at extremes
# Maker fee = 0%, Settlement fee = 0%
fee_model = "polymarket_dynamic"
fee_constant = 0.25
slippage_bps = 5

[orderbook]
snapshot_window_seconds = 30
spoofing_detection_threshold = 0.5
heavy_book_multiplier = 3.0

[liquidity]
min_hourly_volume = 100
max_spread_cents = 0.05

[execution.pricing]
use_clob_pricing = true
max_clob_entry_price = 0.65
max_clob_spread = 0.50

# Per-field CLOB freshness thresholds (seconds)
# bid/ask from WS book snapshots or price_change events — goes stale fast
clob_bid_ask_freshness_seconds = 30
# last_trade from WS trade events — less frequent but still useful
# 600s (5 min) is appropriate for 15m markets: a real trade from 5 min ago
# is still informative, and periodic REST re-polling keeps it fresh.
clob_last_trade_freshness_seconds = 600

# Periodic REST re-poll interval (seconds) for refreshing CLOB data on
# illiquid markets where WS delivers no price_change events.
# Rate impact: 6 requests per 90s = 0.067 req/s (Polymarket allows 10 req/s).
rest_poll_interval_seconds = 90

# GTC-maker mode: post limit orders on the book, let counterparties come to us.
# 0% maker fee (vs 2% taker), we set the price, works on desert books.
# Late-window (minute 11+) still uses FAK taker for urgency.
fak_only = false

# FOK (Fill-Or-Kill) taker execution: cross spread when liquidity appears
fok_spread_threshold = 0.30      # Spread < 30% → eligible for FOK taker
fok_late_minute_threshold = 11   # After minute 11, always attempt FOK
fok_max_entry_price = 0.85       # FOK taker max entry (more permissive than GTC 0.80)

# Confidence-adaptive pricing: scale max entry price with signal confidence
confidence_adaptive_pricing = true
confidence_adaptive_base = 0.85      # start adjusting above this confidence level
confidence_adaptive_scale = 0.50     # max_price += (confidence - base) * scale
confidence_adaptive_cap = 0.92       # absolute ceiling on entry price

# GTC confidence discount: disabled to improve fill rate on thin CLOB books.
# When enabled, discounts GTC limit price below market — reduces fills on
# desert markets where our order is already the only bid.
use_confidence_discount = false

# Use per-signal confidence in Kelly sizing (instead of static estimated_win_prob)
use_signal_confidence_kelly = true
kelly_confidence_floor = 0.80        # never use less than this in Kelly
kelly_confidence_cap = 0.95          # never use more than this in Kelly

# Time-escalating price ladder: passive early, aggressive late
# Offset added to entry price based on minute in window
price_ladder_enabled = true
price_ladder_offset_min2 = 0.00    # minutes 2-4: post at last_trade (no offset)
price_ladder_offset_min5 = 0.03    # minutes 5-7: +3 cents aggressive
price_ladder_offset_min8 = 0.07    # minutes 8-9: +7 cents moderately aggressive
price_ladder_offset_min10 = 0.10   # minute 10: +10 cents aggressive
# Minutes 11+: FAK taker at best_ask (no ladder, crosses spread)

# Use FAK (Fill-And-Kill / IOC) instead of FOK for taker orders
# FAK allows partial fills on thin books — strictly better than FOK
use_fak_taker = true

# Use GTD (Good-Til-Date) auto-expiry instead of manual GTC cancel
use_gtd_expiry = true
gtd_expiry_buffer_seconds = 60     # expire 60s before window settlement

# Reactive FAK sweep: when WS detects counterparty, fire FAK immediately
# Disabled: FAK-only mode doesn't use GTC resting orders to sweep from
reactive_sweep_enabled = false
reactive_sweep_max_price = 0.65    # never sweep above this price

[calibration]
# Bayesian signal calibration: use CLOB mid as prior, model confidence as likelihood
enabled = true
max_edge = 0.15            # posterior never exceeds clob_mid + max_edge
min_edge = 0.04            # minimum fee-adjusted edge to trade (4 cents, maker=0% fee)
default_likelihood_ratio = 1.3  # used when insufficient calibration data
min_samples_for_calibration = 30  # need N outcomes before using empirical LR
fee_constant = 0.25        # Polymarket dynamic fee constant

# CLOB price stability: reject entry when midpoint range exceeds threshold
clob_stability_enabled = true
clob_stability_max_range = 0.20
clob_stability_min_samples = 3

# Coin-flip zone: skip when direction-aware mid is near 0.50 (max uncertainty)
coin_flip_skip_enabled = true
coin_flip_half_width = 0.08
coin_flip_override_edge = 0.06

# Dynamic min edge: scale min_edge with market uncertainty (distance from 0.50)
dynamic_min_edge_enabled = true
uncertainty_penalty_scale = 0.01

[validation]
# Live performance validation — auto-halt on degraded metrics
enabled = true
min_trades_for_check = 20  # start validating after N filled trades
halt_win_rate = 0.45       # halt if WR drops below this
halt_brier_score = 0.30    # halt if Brier score exceeds this
check_interval_trades = 5  # re-check every N trades

[bot]
tick_interval_seconds = 5

[paper]
initial_balance = 10000

[binance]
symbol = "btcusdt"
ws_url = "wss://stream.binance.com:9443/ws/btcusdt@kline_1m"

[polymarket]
clob_url = "https://clob.polymarket.com"
ws_url = "wss://ws-subscriptions-clob.polymarket.com/ws/market"
chain_id = 137
