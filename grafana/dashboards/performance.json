{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "continuous-GrYlRd" },
          "custom": { "fillOpacity": 10 }
        }
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "title": "Cumulative P&L",
      "type": "timeseries",
      "targets": [
        {
          "rawSql": "SELECT time_bucket('1 hour', exit_time) AS time, sum((exit_price - entry_price) * quantity) AS cumulative_pnl FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time) GROUP BY time ORDER BY time",
          "refId": "A",
          "format": "time_series"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 1.0 }, { "color": "green", "value": 2.0 }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 10 },
      "id": 2,
      "title": "Sharpe Ratio (24h)",
      "type": "stat",
      "targets": [
        {
          "rawSql": "SELECT CASE WHEN stddev(pnl) > 0 THEN avg(pnl) / stddev(pnl) * sqrt(96) ELSE 0 END AS sharpe FROM (SELECT (exit_price - entry_price) * quantity AS pnl FROM positions WHERE exit_time IS NOT NULL AND exit_time >= now() - interval '24 hours') sub",
          "refId": "A",
          "format": "table"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.4 }, { "color": "green", "value": 0.55 }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 10 },
      "id": 3,
      "title": "Win Rate (24h)",
      "type": "stat",
      "targets": [
        {
          "rawSql": "SELECT CASE WHEN count(*) > 0 THEN count(*) FILTER (WHERE (exit_price - entry_price) * quantity > 0)::float / count(*)::float ELSE 0 END AS win_rate FROM positions WHERE exit_time IS NOT NULL AND exit_time >= now() - interval '24 hours'",
          "refId": "A",
          "format": "table"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "thresholds": { "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 10 },
      "id": 4,
      "title": "Total Trades (24h)",
      "type": "stat",
      "targets": [
        {
          "rawSql": "SELECT count(*) FROM positions WHERE exit_time IS NOT NULL AND exit_time >= now() - interval '24 hours'",
          "refId": "A",
          "format": "table"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "green", "value": 0 }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 10 },
      "id": 5,
      "title": "Net P&L (24h)",
      "type": "stat",
      "targets": [
        {
          "rawSql": "SELECT sum((exit_price - entry_price) * quantity) AS net_pnl FROM positions WHERE exit_time IS NOT NULL AND exit_time >= now() - interval '24 hours'",
          "refId": "A",
          "format": "table"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "fillOpacity": 30 }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 },
      "id": 6,
      "title": "Daily Returns",
      "type": "barchart",
      "targets": [
        {
          "rawSql": "SELECT date_trunc('day', exit_time) AS day, sum((exit_price - entry_price) * quantity) AS daily_return FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time) GROUP BY day ORDER BY day",
          "refId": "A",
          "format": "table"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": { "color": { "mode": "palette-classic" } }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 14 },
      "id": 7,
      "title": "Exit Reasons Distribution",
      "type": "piechart",
      "targets": [
        {
          "rawSql": "SELECT exit_reason, count(*) AS count FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time) GROUP BY exit_reason ORDER BY count DESC",
          "refId": "A",
          "format": "table"
        }
      ]
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "continuous-GrYlRd" },
          "custom": {
            "cellOptions": { "type": "color-background" }
          }
        }
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 22 },
      "id": 8,
      "title": "Monthly P&L Heatmap",
      "type": "table",
      "targets": [
        {
          "rawSql": "SELECT extract(year FROM exit_time)::int AS year, to_char(exit_time, 'Mon') AS month, extract(month FROM exit_time)::int AS month_num, sum((exit_price - entry_price) * quantity) AS monthly_pnl FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time) GROUP BY year, month, month_num ORDER BY year, month_num",
          "refId": "A",
          "format": "table"
        }
      ],
      "options": {
        "showHeader": true,
        "cellHeight": "md"
      }
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "fillOpacity": 20 },
          "unit": "m"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 30 },
      "id": 9,
      "title": "Trade Duration Distribution",
      "type": "histogram",
      "targets": [
        {
          "rawSql": "SELECT extract(epoch FROM (exit_time - entry_time)) / 60.0 AS duration_minutes FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time)",
          "refId": "A",
          "format": "table"
        }
      ],
      "options": {
        "bucketSize": 1,
        "combine": false
      }
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "percentunit",
          "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.4 }, { "color": "green", "value": 0.55 }] }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 30 },
      "id": 10,
      "title": "Accuracy by Minute",
      "type": "barchart",
      "targets": [
        {
          "rawSql": "SELECT extract(minute FROM entry_time)::int AS entry_minute, CASE WHEN count(*) > 0 THEN count(*) FILTER (WHERE (exit_price - entry_price) * quantity > 0)::float / count(*)::float ELSE 0 END AS win_rate, count(*) AS trade_count FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time) GROUP BY entry_minute ORDER BY entry_minute",
          "refId": "A",
          "format": "table"
        }
      ],
      "options": {
        "xField": "entry_minute"
      }
    },
    {
      "datasource": { "type": "postgres", "uid": "timescaledb" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "continuous-blues" },
          "custom": { "fillOpacity": 10 },
          "unit": "currencyUSD"
        }
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 38 },
      "id": 11,
      "title": "Balance Over Time",
      "type": "timeseries",
      "targets": [
        {
          "rawSql": "SELECT exit_time AS time, sum((exit_price - entry_price) * quantity) OVER (ORDER BY exit_time) AS running_balance FROM positions WHERE exit_time IS NOT NULL AND $__timeFilter(exit_time) ORDER BY exit_time",
          "refId": "A",
          "format": "time_series"
        }
      ]
    }
  ],
  "schemaVersion": 39,
  "tags": ["mvhe", "performance"],
  "templating": { "list": [] },
  "time": { "from": "now-7d", "to": "now" },
  "title": "MVHE - Performance",
  "uid": "mvhe-performance",
  "version": 2
}
